Revolut

stress/scenario testing

fake data - root cause analysis + solution

1. Improving KYC
Document check: To verify that the photo ID is valid and authentic;
Facial Similarity check: To verify that the face in the picture is the same with that on the submitted ID.
The customer will ‘pass’ the KYC process and get onboarded if the results of both Document and Facial Similarity checks are ‘clear’. 
If the result of any check is not ‘clear’, the customer has to submit all the photos again.
The “pass rate” is defined as the number of customers who pass both the KYC process divided by the number of customers who attempt the process. 
Each customer has up to 2 attempts.

The pass rate has decreased substantially in the recent period:
Root Causes
facial_similarity_reports.csv
result: clear/consider: 
face_comparison_result: clear/consider: when 'clear', result is always 'clear'
facial_image_integrity_result: clear/consider: result undetermined from clear
visual_authenticity_result: clear/consider: result undetermined from clear
properties
attempt_id

facial_similarity_reports
- check for null values
- check multiple attempts per user_id (and vice versa)

- get date
- get score

- check why score is sometimes blank (properties = {})


- order by created_at date
 - test theory that pass rate has decreased substantially

- check # of attempts per user_id

- check all attemptids & user_ids match between csvs
- check results match
- check created_at datetimes match


doc_reports: 

result == sub_result?
if sub_result != 'clear', result = 'consider'


test 2 attempts claim: each candidate has up to 2 attempts


Solutions


Data Check Results:
4512 duplicates removed: 171892 unique values

user_id: 7563e310fa9d4cef9f44c12a3f693106
attempt_id: 9.6949E+31
9.69E+31
Excel formatting issue means attempt does not match as Excel attempts to convert attempt_id number

11/08/2017 - number of results is different between datasets because attemptid 'ae75f9608c9243709d1d47875f1a7852' is missing a value in facial results (user_id 'c198f9f7a4844f179ceb98e11fbed371')

Facial:
blank scores: no clear result
value < 0.5 always "consider"
value > 0.5 always "clear"
if only 1 test (of 3) passed then always "consider": 1 exception of "clear" with  no tests passed (2 missing results; 1 consider) attempt_id 'a0bf9dace6e34e19b97bfecd457a4031', user_id '6c1cd3b5d978419594e0ab5c2f6d4a25'
if 3 tests (of 3) passed then always "clear"
if face_comparison_result is "clear" then result = "clear"
facial_image_integrity_result can be clear/consult and still pass





2. Fraud

Query Intention: Shows sum total transaction amounts in EUR each user made per country for transactions sourced from "GAIA"

Fixed errors:
1."currency" field does not exist in currency_details table (it's called "ccy" according to schema)
2. Tries to join transaction table's "merchant_country" field (varchar(3)) to processed_users "short_phone_country" which has been setup as 2 characters

Query to identify users whose first transaction was successful card payment over USD 10 equivalent

SELECT t.user_id, (t.amount / fx.rate / Power(10, cd.exponent)) AS USD_amount

FROM transactions t

JOIN fx_rates fx
    ON (fx.ccy = t.currency
    AND fx.base_ccy = 'USD')
JOIN currency_details cd
    ON cd.ccy = t.currency

JOIN
(
SELECT t.user_id, MIN(t.created_date) as first_tx
FROM transactions t
GROUP BY
    t.user_id
) first_tx
ON
    first_tx.user_id = t.user_id
    AND
    first_tx.first_tx = t.created_date

WHERE
    (t.amount / fx.rate / Power(10, cd.exponent)) > 10
    AND
    t.type = 'CARD_PAYMENT'
    AND state = 'COMPLETED'
;
